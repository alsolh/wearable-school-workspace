<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width,user-scalable=no">
<title>Circular UI</title>
<link rel="stylesheet" href="lib/tau/wearable/theme/default/tau.min.css">
<link rel="stylesheet" media="all and (-tizen-geometric-shape: circle)"
	href="lib/tau/wearable/theme/default/tau.circle.min.css">
<!-- load theme file for your application -->
<link rel="stylesheet" href="css/style.css">
</head>
<body>
	<div class="ui-page ui-page-active" id="main">
		<header class="ui-header">
			<h2 class="ui-title">Wearable School</h2>
		</header>
		<div id="tizenId" style="font-size: 2em; text-align:center">Sensor Data Collection Active</div>
		<br />
		<div class="ui-content content-padding">
			<img src="images/lock.png" width="128" height="128"> <br>
			
		</div>
	</div>
	<script type="text/javascript" src="js/log4javascript.js"></script>
	<script type="text/javascript" src="js/batterylog.js"></script>
	<script type="text/javascript" src="lib/tau/wearable/js/tau.min.js"></script>
	<!-- <script src="js/app.js"></script> -->
	<script src="lowBatteryCheck.js"></script>
	<script src="js/tau-config.js"></script>
<!-- 	<script src="lib/tau/wearable/js/tau.js"></script> -->
	<script src="js/core/core.js" data-main="./js/app.js"></script>
	<script>
var tizenId = tizen.systeminfo.getCapability("http://tizen.org/system/tizenid");
document.getElementById("tizenId").innerText = tizenId;
console.log(" tizenid = " + tizenId);
isWatchRegistered(tizenId);

function isWatchRegistered(watchId){
    // Register Watch couchdb
    var data = {
    "_id": watchId
};
var req = new XMLHttpRequest();
    req.open("GET", 'http://alsolh.myqnapcloud.com:32772/watches/' + watchId, true);
req.setRequestHeader("Authorization", "Basic " + btoa('admin' + ":" + 'asolh787'));
    req.setRequestHeader("Content-type", "application/json");
    req.onreadystatechange = function() {
        if (this.readyState == 4) {
                    console.log(this.status + ' - ' + this.responseText);
        var response = JSON.parse(this.responseText);
        	if(response.studentId != null){
            window.open('authorized.html');
            }
            else
            {
            registerWatch(data)
			}
       }
    };
    req.send(JSON.stringify(data));
}

function registerWatch(data){
        var req = new XMLHttpRequest();
    req.open("POST", 'http://alsolh.myqnapcloud.com:32772/watches', true);
req.setRequestHeader("Authorization", "Basic " + btoa('admin' + ":" + 'asolh787'));
    req.setRequestHeader("Content-type", "application/json");
    req.onreadystatechange = function() {
        if (this.readyState == 4) {
            console.log(this.status + ' - ' + this.responseText);
            //window.open('authorized.html');
       }
    };
    req.send(JSON.stringify(data));
}
 
    </script>
</body>
</html>
